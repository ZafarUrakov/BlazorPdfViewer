@page "/"
@rendermode InteractiveAuto
@inject IInteroplyService Interoply
@using Interoply
@using Syncfusion.Blazor.SfPdfViewer

<style>
    .e-pv-loading-indicator,
    .e-pv-loading,
    .e-spinner-pane {
        display: none !important;
    }

    .e-pv-viewer-container,
    .e-pdfviewer,
    .e-pv-viewer {
        border: none !important;
    }

        .e-pv-viewer-container::before,
        .e-pv-viewer-container::after {
            display: none !important;
        }

    .e-pv-viewer-container {
        background: white !important;
    }
</style>

<SfPdfViewer2 @ref="pdfViewer"
              DocumentPath="@Path"
              Height="100vh"
              Width="100%"
              EnableTextMarkupAnnotation="true"
              EnableZoomOptimization="true"
              EnablePinchZoom="true">

    <PdfViewerEvents />
</SfPdfViewer2>

@code
{
    private SfPdfViewer2 pdfViewer;
    private string Path { get; set; } = @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_100p.pdf";
    private int pendingZoom = 100;
    public bool IsNativeZoom { get; set; } = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Interoply.RegisterOnResizeListnerAsync(OnResize);
        }
    }

    private async ValueTask OnResize(int width)
    {
        int newZoom = width switch
        {
            <= 1200 => 400,  // 0–900 px → max zoom
            <= 1300 => 200,  // 901–1200 px
            <= 1400 => 150,  // 1201–1400 px
            <= 1600 => 125,  // 1401–1600 px
            <= 1800 => 100,  // 1601–1800 px
            _ => 100
        };

        var newPath = MapZoomToFile(newZoom);
        if (newPath != Path)
        {
            Path = newPath;
            await pdfViewer.LoadAsync(newPath);
            IsNativeZoom = true;
        }
    }

    private static string MapZoomToFile(int z) => z switch
    {
        >= 10 and < 25 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_10p.pdf",
        >= 25 and < 50 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_25p.pdf",
        >= 50 and < 75 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_50p.pdf",
        >= 75 and < 100 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_75p.pdf",
        >= 100 and < 125 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_100p.pdf",
        >= 125 and < 150 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_125p.pdf",
        >= 150 and < 200 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_150p.pdf",
        >= 200 and < 400 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_200p.pdf",
        >= 400 and <= 1000 => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_400p.pdf",
        _ => @"C:\Users\133\source\repos\BlazorPdfViewer\BlazorPdfViewer\wwwroot\ZoomLevels\Chapter_14_Zoom_100p.pdf"
    };
}